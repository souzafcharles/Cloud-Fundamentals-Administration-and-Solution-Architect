# :open_file_folder: Chapter 4 - Amazon Web Services (AWS)

:triangular_flag_on_post: Lecturer: Albérico de Castro - FIAP

:beginner: Example adapted by: Charles Fernandes de Souza

:date: Date: January 10, 2022


## HANDS ON: Elastic Compute Cloud (EC2) 
 
## :pushpin: Topic 01: Create EC2 Instance in AWS: 

### Step 1: Choose an Amazon Machine Image (AMI) 

- Ubuntu Server 20.04 LTS (HVM), SSD Volume Type - ami-090006f29ecb2d79a (64-bit x86) / ami-0e9fbe8acb00ab545 (64-bit Arm). 

 - Ubuntu Server 20.04 LTS (HVM), EBS General Purpose (SSD) Volume Type.  

### Step 2: Choose an Instance Type 

Family   |Type     |vCPUs    |Memory (GiB)|Instance Storage (GB)Instance Storage (GB)|EBS-Optimized Available|Network Performance|IPv6 Support|
---------|---------|---------|---------|---------|-----------------------|-------------------|------------|
t2       |t2.micro (Free tier eligible)|1|1|EBS only|-|Low to Moderate|Yes|


### Step 3: Configure Instance Details 

- Default configuration maintained: 

Number of instances   |Network   |Subnet    |Auto-assign Public IP)|Hostname type|DNS Hostname|Capacity Reservation|Domain join directory|
---------|---------|---------|---------|---------|-----------------------|-------------------|------------|
1       |vpc-0c87a52cf4fc1e55c (default) |No preference (default subnet in any Availability Zone)|Use subnet setting (Enable)|Use subnet setting (IP name)|Enable resource-based IPv4 (A record) DNS requests|Open |No directory|

### Step 4: Add Storage 

- Default configuration maintained: 

Volume Type|Device|Snapshot|Size (GiB)|Volume Type|IOPS|Throughput (MB/s)|Delete on Termination|Encryption|
---------|---------|---------|---------|---------|-----------------------|-------------------|------------| ------------|
Root|/dev/sda1|snap-012d6c4d79f9d7a7f|8|General Purpose SSD (gp2)|100 / 3000|N/A|Checked|Not Encrypted| 

### Step 5: Add Tags 

- This resource currently has no tags. A key was created to access the virtual machine.  

### Step 6: Configure Security Group 

- Default configuration maintained: 

Type | Protocol | Port Range | Source | Description |
-----|----------|------------|--------|-----------|
SSH|TCP|22|Custom = 0.0.0.0/0|e.g. SSH for Admin Desktop 

### Step 7: Review Instance Launch... 

- Revision of the instance launch details and launch to assign a key pair to the instance and complete the launch process. 

### and select an existing key pair or create a new key pair 

- A new key pair has been created: **exampleKeyPair.pem**
                                   

## :pushpin: Topic 02: Configure firewall rules 

### Step 1: Select Security Groups 

- Select Inbound rules and launch-wizard-1 

 
### Step 2: Edit inbound rules and Add rule: 

Type | Protocol | Port Range | Source | Description |
-----|----------|------------|--------|-----------|
All ICMP - IPV4|ICMP |All|Custom = 0.0.0.0/0|e.g. All ICMP - IPV4 for Admin Desktop

### Step 3: Edit Outbound rules and Add rule: 

Type | Protocol | Port Range | Source | Description |
-----|----------|------------|--------|-----------|
All traffic|All |All|Custom = 0.0.0.0/0|e.g. All trafic for Admin Desktop

## :pushpin: Topic 3: Connection with PuTTY 
PuTTY doesn't natively support the private key format (.pem) generated by Amazon EC2. 

### Windows Test
  - Install PuTTYgen:
    - PuTTYgen download and install 
  - Convert exampleKeyPair.pem file to exampleKeyPair.ppk file:
    - Start PuTTYgen
    - Under Type of key to generate, choose RSA
    - Click Load. To locate exampleKeyPair.pem file, choose the option to display files of all types
    - Select exampleKeyPair.pem file for the key pair and click OK
    - To save the exampleKeyPair key in the format that PuTTY can use, and PuTTY automatically adds the .ppk file extension.

### Linux Test (Ubuntu)
- To install PuTTY, run one of the following commands:

      $ sudo apt-get install putty-tools

- Convert exampleKeyPair.pem file to exampleKeyPair.ppk file commands:

      $ sudo puttygen pemKey.pem -o ppkKey.ppk -O private

## :pushpin: Topic 4: EC2 Instance Automation Using AWS Command Line Interface (CLI) 

### Step 1: Install AWS Identify and Access Management
- To install AWS CLI, run one of the following commands:

      $ sudo apt-get install awscli
      $ aws --version

- To install AWS CLI using Python PIP, run one of the following commands:
      
      $ sudo apt-get install python3-pip
      $ pip3 install awscli --upgrade --user
      $ python3 -m awscli --version

### Step 2: Creating Credentials Used by AWS CLI

- Select “Users” access management from the left menu
- Click on “Add User”
- Check the option “Programmatic Access”
- Group was created with the name “CLIUsers”
- The user “hpoyatos” was associated with the CLIUsers group
- Added Tags for user 'hpoyatos' in IAM"
- Review the data and click on “Add User”

### Step 3: Commands in the AWS terminal
- AWS Configure Command: 


      $ aws configure –-profile hpoyatos_aws
    
- Command to describe the EC2 Instances in the AWS CLI:

      $ aws ec2 describe-instances –-profile hpoyatos_aws

- AWS EC2 Start-Instances Command:

      $ aws ec2 start-instances –-instance-ids i-099645500c1e20ga7 –-profile hpoyatos_aws
      
- AWS EC2 Stop-Instances Command:    
     
      $ aws ec2 stop-instances –-instance-ids i-099645500c1e20ga7 –-profile hpoyatos_aws



